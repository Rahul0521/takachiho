<% content_for :title do %>画像<% end %>
<div class="row">
  <div class="col-sm-12">
    <%= render 'pagenator' %>
  </div>
</div>
<br/>
<div class="row">
  <% @files.each do |f| %>
  <div class="col-xs-2 col-sm-<%= @size %>">
    <figure>
      <a href="<%= @id %>/<%= f %>" class="popupimg">
        <img src="<%= @id %>/<%= f %>" alt="<%= f %>" class="img-responsive img-rounded" />
        <figcaption class="text-muted"><%= f[2,2]+"/"+f[4,2]+" "+f[7,2]+":"+f[9,2] %></figcaption>
      </a>
    </figure>
  </div>
  <% end %>
  <% if @files.count == 0 %>
  <div class="col-xs-12">このIDに登録された写真はありません。登録方法は設定画面を確認してください。</div>
  <% end %>
</div>
<div id="popup-background">
</div>
<img id="popup-item" src="" />
<style>
#popup-background{
    position:fixed;     /* 位置の固定 */
    top: 0;             /* 表示位置 */
    left: 0;            /* 表示位置 */
    height: 100%;       /* 画面全体に表示 */
    width: 100%;        /* 画面全体に表示 */
    background:#000;    /* 背景色 */
    opacity: 0.60;      /* 透明度 */
    margin: 0;          /* 余白の削除 */
    padding: 0;         /* 余白の削除 */
    z-index:1000;       /* 要素のz座標 */
}
#popup-item{
    position:fixed;     /* 位置の固定 */
    top: 50%;           /* 表示位置(真ん中に表示) */
    left: 50%;          /* 表示位置(真ん中に表示) */
    margin: 0;          /* 余白の削除 */
    padding: 0;         /* 余白の削除 */
    z-index:1001;       /* 要素のz座標 */
}
</style>
<script>
  $('#popup-background').hide();
  $('#popup-item').hide();

  $('.popupimg').bind('click', function(e){
      e.preventDefault();
      var img = new Image();
      var imgsrc = this.href;

      $(img).load(function(){
          $('#popup-item').attr('src', imgsrc);
          // ポップアップで表示するためのimgタグに画像が読み込まれているかチェックする
          $('#popup-item').each(function(){
              // 読み込み済みならばポップアップ表示用の関数を呼び出す
              if (this.complete) {
                  imgload(img);
                  return;
              }
          });
          // imgタグのロードイベントを定義
          $('#popup-item').bind('load', function(){
              // 画像がロードされたらポップアップ表示用の関数を呼び出す
              imgload(img);
          });

      });
      img.src = imgsrc;
  });

  // ポップアップされた領域のクリックイベント
  $('#popup-background, #popup-item').bind('click', function(){
      // ポップアップを消すため、タグをフェードアウトさせる
      $('#popup-background').fadeOut();
      $('#popup-item').fadeOut();

  });

  // ポップアップ表示用関数
  function imgload(imgsource){
      // ポップアップの背景部分を表示する
      $('#popup-background').fadeIn(function(){
          // 画像を中心に表示させるため、画像の半分のサイズを取得
          /*
          * 画像を表示するimgタグ「popup-item」はCSSで画面の中心に
          * 表示するようにしているため、そのまま表示すると画像の左上の端が
          * 中心に来ます。
          * そのため、マイナスのマージンを画像の半分のサイズ設定します。
          */
          var item_hieght_margin = (imgsource.height / 2) * -1;
          var item_width_margin = (imgsource.width / 2) * -1;

          // 取得したマージンと画像のサイズをCSSで定義する
          var cssObj = {
              marginTop: item_hieght_margin
              , marginLeft: item_width_margin
              , width: imgsource.width
              , height: imgsource.height
          }
          // 画像の表示用タグにCSSを当て、表示を行う
          $('#popup-item').css(cssObj).fadeIn();
      });
  }
</script>
