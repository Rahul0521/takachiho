<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src='//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js'></script>
  <script>
  $(function () {
    var recognizer_pair = [
      [ "ORB", "ORB", "" ],// optionは後で検討
      [ "GRID_ORB", "ORB", "" ],
      [ "PYRAMID_ORB", "ORB", "" ],
      [ "DYNAMIC_ORB", "ORB", "" ],
      [ "ORB", "OPPONENT_ORB", "" ],
      [ "GRID_ORB", "OPPONENT_ORB", "" ],
      [ "PYRAMID_ORB", "OPPONENT_ORB", "" ],
      [ "DYNAMIC_ORB", "OPPONENT_ORB", "" ],
      [ "AKAZE", "AKAZE", "" ],
    ];

    $('#fileInput').change(function () {
      for (var recognizer of recognizer_pair) {
        postRequest(this.files[0], recognizer);
      }
    });

    function postRequest(query_image,recognaizer) {
      var formData = new FormData();
      formData.append("userfile", query_image);

      // Ajaxで質問画像をアップロード
      $.ajax('/Upload', {
        type: 'post',
        data: formData,
        processData: false,
        contentType: false,
        dataType: 'json'
      }).done(function (json) {
        // 結果をリストに表示
        $('#result').html(generateHtml(json));
      });
    }

    function generateHtml(json) {
      var html = 'time: ' + json.time + ' ms<br/>';
      var resultsJson = json.results;
      for (var i in resultsJson) {
        var d = resultsJson[i];
        html += '<li><img src=' + d.labelImgSrc + ' width="100" height="130">' +
          d.label + ', JANコード：' + d.jan + ', スコア：' + d.score +
          ' (' + Math.round(d.similarytyRatio * 1000) / 10 + '%)' + '</li>';
      }
      return html;
    }
  });
  </script>
</head>
<body>
  <input type="file" id="fileInput" accept="image/*" capture="camera">
  <ol id="result"></ol>
</body>
</html>
